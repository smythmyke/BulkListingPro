<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BulkListingPro</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="header">
      <h1>BulkListingPro</h1>
      <div id="credit-balance" class="credit-balance">
        <span class="credits">--</span> credits
      </div>
    </header>

    <!-- Page Status -->
    <div id="page-status" class="page-status disconnected">
      <span class="status-dot"></span>
      <span id="status-text">Not on Etsy</span>
    </div>

    <!-- Setup Section (shown when setup incomplete) -->
    <div id="setup-section" class="section hidden">
      <h2>Get Started</h2>
      <p class="setup-intro">Just one step to start uploading:</p>

      <div class="setup-steps">
        <!-- Primary Step: Etsy Login -->
        <div class="setup-step" id="step-etsy">
          <div class="step-header">
            <span class="step-number">1</span>
            <span class="step-title">Log into Etsy</span>
            <span class="step-status" id="etsy-status">Not logged in</span>
          </div>
          <div class="step-content">
            <p>Log into your Etsy seller account in this browser.</p>
            <div class="step-actions">
              <a href="https://www.etsy.com/signin" target="_blank" class="btn btn-primary" id="open-etsy-btn">Open Etsy Login</a>
            </div>
            <p class="auto-detect-hint">We'll automatically detect when you're logged in.</p>
          </div>
        </div>
      </div>

      <!-- Power Mode Section (Advanced) -->
      <details id="power-mode-section" class="power-mode-section">
        <summary class="power-mode-header">
          <span class="power-mode-title">Advanced: Enable Power Mode</span>
          <span class="power-mode-badge" id="power-mode-badge">Optional</span>
        </summary>
        <div class="power-mode-content">
          <p class="power-mode-intro">Power Mode enables spreadsheet imports with local file paths (e.g., C:\Products\image.jpg). Most users don't need this.</p>
          <p id="power-mode-status" class="power-mode-status hidden"></p>

          <div class="setup-steps">
            <!-- Power Step: Native Host -->
            <div class="setup-step" id="step-native">
              <div class="step-header">
                <span class="step-number">1</span>
                <span class="step-title">Install Helper App</span>
                <span class="step-status" id="native-status">Not installed</span>
              </div>
              <div class="step-content">
                <p>Download and run the installer for your system:</p>
                <div class="step-actions">
                  <a href="https://github.com/smythmyke/BulkListingPro/releases/download/v0.1.0/BulkListingPro-Setup-v0.1.0.exe" id="download-windows" class="btn btn-primary btn-small" target="_blank">Download for Windows</a>
                </div>
                <details class="install-help">
                  <summary>Installation instructions</summary>
                  <ol>
                    <li>Download the installer above</li>
                    <li>Run the installer (see note about Windows warning below)</li>
                    <li>Follow the setup wizard</li>
                    <li>Click "Check Again" below</li>
                  </ol>
                  <p class="smartscreen-note"><strong>Windows SmartScreen:</strong> You may see "Windows protected your PC". Click <em>"More info"</em> then <em>"Run anyway"</em>. This is normal for new software.</p>
                </details>
              </div>
            </div>
          </div>
        </div>
      </details>

      <div class="setup-actions">
        <button id="check-setup-btn" class="btn btn-primary">Check Again</button>
      </div>
    </div>

    <!-- Auth Section (shown when setup complete but logged out) -->
    <div id="auth-section" class="section hidden">
      <p>Sign in to start uploading listings</p>
      <button id="sign-in-btn" class="btn btn-primary">
        Sign in with Google
      </button>
    </div>

    <!-- Main Section (shown when logged in) -->
    <div id="main-section" class="section hidden">
      <!-- User info -->
      <div id="user-info" class="user-info">
        <img id="user-avatar" src="" alt="Avatar" class="avatar">
        <span id="user-email"></span>
        <button id="sign-out-btn" class="btn btn-small">Sign out</button>
      </div>

      <!-- Credits Info -->
      <div class="credits-info">
        Each listing uses <strong>2 credits</strong>
      </div>

      <!-- Upload Options -->
      <div class="upload-options">
        <h2>Upload Listings</h2>

        <!-- Spreadsheet Upload -->
        <div class="upload-zone" id="drop-zone">
          <p>Drag & drop spreadsheet here</p>
          <p class="small">or</p>
          <input type="file" id="file-input" accept=".xlsx,.xls,.csv" hidden>
          <button id="browse-btn" class="btn">Browse Files</button>
          <a href="../templates/BulkListingPro-template.xlsx" download class="template-link">
            Download spreadsheet template
          </a>
        </div>

        <!-- Single Listing Form (collapsed by default) -->
        <details class="single-listing">
          <summary>Or create single listing</summary>
          <form id="single-listing-form">
            <div class="form-group">
              <label for="title">Title</label>
              <input type="text" id="title" name="title" maxlength="140" required>
            </div>
            <div class="form-group">
              <label for="category">Category</label>
              <select id="category" name="category">
                <option value="Digital Prints">Digital Prints</option>
                <option value="Guides & How Tos">Guides & How Tos</option>
                <option value="Drawing & Illustration">Drawing & Illustration</option>
                <option value="Digital Patterns">Digital Patterns</option>
                <option value="Planners & Templates">Planners & Templates</option>
                <option value="Clip Art & Image Files">Clip Art & Image Files</option>
                <option value="Cutting Machine Files">Cutting Machine Files (SVG)</option>
                <option value="Embroidery Machine Files">Embroidery Machine Files</option>
                <option value="3D Printer Files">3D Printer Files</option>
                <option value="Knitting Machine Files">Knitting Machine Files</option>
                <option value="Social Media Templates">Social Media Templates</option>
                <option value="Resume Templates">Resume Templates</option>
                <option value="Greeting Card Templates">Greeting Card Templates</option>
                <option value="Menu Templates">Menu Templates</option>
                <option value="Event Program Templates">Event Program Templates</option>
                <option value="Newsletter Templates">Newsletter Templates</option>
                <option value="Personal Finance Templates">Personal Finance Templates</option>
                <option value="Bookkeeping Templates">Bookkeeping Templates</option>
                <option value="Contract & Agreement Templates">Contract & Agreement Templates</option>
                <option value="Flashcards">Flashcards</option>
                <option value="Study Guides">Study Guides</option>
                <option value="Worksheets">Worksheets</option>
                <option value="Fonts">Fonts</option>
                <option value="Photography">Photography</option>
              </select>
            </div>
            <div class="form-group hidden" id="craft-type-group">
              <label for="craft-type">Craft Type</label>
              <select id="craft-type" name="craft_type">
                <option value="Scrapbooking">Scrapbooking (default)</option>
                <option value="Card making & stationery">Card making & stationery</option>
                <option value="Collage">Collage</option>
                <option value="Kids' crafts">Kids' crafts</option>
              </select>
            </div>
            <div class="form-group">
              <label for="description">Description</label>
              <textarea id="description" name="description" rows="4"></textarea>
            </div>
            <div class="form-group">
              <label for="price">Price ($)</label>
              <input type="number" id="price" name="price" step="0.01" min="0.20" required>
            </div>
            <div class="form-group">
              <label for="tags">Tags (comma separated)</label>
              <input type="text" id="tags" name="tags" placeholder="tag1, tag2, tag3">
            </div>
            <div class="form-group">
              <label>Images (up to 5)</label>
              <div id="image-drop-zone" class="image-drop-zone">
                <div id="image-previews" class="image-previews"></div>
                <div id="image-drop-prompt" class="image-drop-prompt">
                  <p>Drop images here or <button type="button" id="image-browse-btn" class="btn-link">browse</button></p>
                </div>
                <input type="file" id="image-file-input" accept="image/*" multiple hidden>
              </div>
            </div>
            <div class="form-group">
              <label>Digital File</label>
              <div id="digital-file-zone" class="digital-file-zone">
                <div id="digital-file-info" class="digital-file-info hidden">
                  <span id="digital-file-name" class="digital-file-name"></span>
                  <button type="button" id="digital-file-remove" class="remove-image">&times;</button>
                </div>
                <div id="digital-file-prompt">
                  <button type="button" id="digital-file-browse-btn" class="btn btn-small">Choose File</button>
                </div>
                <input type="file" id="digital-file-input" hidden>
              </div>
            </div>
            <button type="submit" class="btn btn-primary">Add to Queue</button>
          </form>
        </details>
      </div>

      <!-- Upload Queue -->
      <div id="queue-section" class="queue-section hidden">
        <h2>
          <label class="queue-select-all">
            <input type="checkbox" id="select-all-checkbox" checked>
          </label>
          Upload Queue (<span id="queue-count">0</span>)
        </h2>
        <div id="queue-list" class="queue-list">
          <!-- Queue items will be inserted here -->
        </div>
        <div class="queue-options">
          <label for="listing-state-select">Save as:</label>
          <select id="listing-state-select" class="listing-state-select">
            <option value="draft" selected>Draft (recommended)</option>
            <option value="active">Published</option>
          </select>
        </div>
        <div class="queue-actions">
          <button id="start-upload-btn" class="btn btn-primary" disabled>
            Start Upload
          </button>
          <button id="clear-queue-btn" class="btn btn-secondary">
            Clear Queue
          </button>
        </div>
      </div>

      <!-- Progress Section -->
      <div id="progress-section" class="progress-section hidden">
        <h2>Uploading...</h2>
        <div class="progress-bar">
          <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>
        <p id="progress-text">0 of 0 listings</p>
        <p id="current-listing" class="current-listing"></p>
        <div class="progress-actions">
          <button id="pause-btn" class="btn btn-secondary">Pause</button>
          <button id="skip-btn" class="btn btn-secondary" disabled>Skip</button>
          <button id="cancel-btn" class="btn btn-danger">Cancel</button>
        </div>
      </div>

      <!-- Results Section -->
      <div id="results-section" class="results-section hidden">
        <h2>Upload Complete</h2>
        <div class="results-summary">
          <div class="stat success"><span id="results-success">0</span> Succeeded</div>
          <div class="stat failed"><span id="results-failed">0</span> Failed</div>
          <div class="stat skipped"><span id="results-skipped">0</span> Skipped</div>
        </div>
        <div id="results-list" class="results-list"></div>
        <div class="results-actions">
          <button id="retry-failed-btn" class="btn btn-secondary hidden">Retry Failed</button>
          <button id="new-upload-btn" class="btn btn-primary">Upload More</button>
        </div>
      </div>
    </div>

    <!-- Buy Credits Modal -->
    <div id="credits-modal" class="modal hidden">
      <div class="modal-content">
        <h2>Buy Credits</h2>
        <p class="modal-subtitle">Select a credit pack to continue uploading</p>
        <div id="credit-packs" class="credit-packs">
          <!-- Packs loaded dynamically -->
          <div class="skeleton skeleton-text" style="height: 60px; margin-bottom: 8px;"></div>
          <div class="skeleton skeleton-text" style="height: 60px; margin-bottom: 8px;"></div>
          <div class="skeleton skeleton-text" style="height: 60px; margin-bottom: 8px;"></div>
        </div>
        <div class="modal-actions">
          <button id="buy-credits-btn" class="btn btn-primary">Buy Now</button>
          <button id="close-modal-btn" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>
  </div>

  <script src="lib/xlsx.full.min.js"></script>
  <script src="lib/papaparse.min.js"></script>
  <script src="sidepanel.js" type="module"></script>
</body>
</html>
